/**
 * LindemannRock Analytics Helpers
 *
 * Provides helper functions for cp-analytics layout.
 * Requires Chart.js to be loaded first.
 *
 * @copyright Copyright (c) 2026 LindemannRock
 */
!function(t){"use strict";t.lrChartColors=["#0d78f2","#10b981","#ef4444","#f59e0b","#8b5cf6","#06b6d4","#ec4899","#84cc16","#f97316","#6366f1","#14b8a6","#f43f5e"],t.lrChartInstances={},t.lrAnalyticsInit=function(a){var n=(a=a||{}).prefix||"analytics";t.lrChartInstances[n]||(t.lrChartInstances[n]={}),t.lrAnalyticsConfig=a,document.dispatchEvent(new CustomEvent("lr:analyticsInit",{detail:{dateRange:a.dateRange||"last7days",siteId:a.siteId||"",customFilters:a.customFilters||{},config:a}}))},t.lrLoadChartData=function(a,n,e){var r=t.lrAnalyticsConfig||{};if(r.dataEndpoint){e=e||{};var s=Object.assign({type:a,dateRange:r.dateRange||"last7days",siteId:r.siteId||""},e);if(r.csrfName&&r.csrfToken&&(s[r.csrfName]=r.csrfToken),"undefined"!=typeof $&&$.ajax)$.ajax({url:r.dataEndpoint,type:"POST",dataType:"json",data:s,success:function(t){t.success&&t.data&&n(t.data)},error:function(t,a,n){console.error("lrLoadChartData error:",n)}});else{var o=new FormData;Object.keys(s).forEach(function(t){o.append(t,s[t])}),fetch(r.dataEndpoint,{method:"POST",body:o}).then(function(t){return t.json()}).then(function(t){t.success&&t.data&&n(t.data)}).catch(function(t){console.error("lrLoadChartData error:",t)})}}else console.warn("lrLoadChartData: No dataEndpoint configured")},t.lrCreateChart=function(a,n,e,r){var s=document.getElementById(a);if(!s)return console.warn("lrCreateChart: Canvas not found:",a),null;if("undefined"==typeof Chart)return console.error("lrCreateChart: Chart.js not loaded"),null;var o=(t.lrAnalyticsConfig||{}).prefix||"analytics",c=a.replace(/-/g,"_");t.lrChartInstances[o]&&t.lrChartInstances[o][c]&&t.lrChartInstances[o][c].destroy();var i={responsive:!0,maintainAspectRatio:"doughnut"===n||"pie"===n,plugins:{legend:{position:"doughnut"===n||"pie"===n?"bottom":"top"}}};"line"!==n&&"bar"!==n||(i.scales={y:{beginAtZero:!0,ticks:{stepSize:1,precision:0}}});var l=Object.assign({},i,r||{}),d=new Chart(s,{type:n,data:e,options:l});return t.lrChartInstances[o]||(t.lrChartInstances[o]={}),t.lrChartInstances[o][c]=d,d},t.lrDestroyCharts=function(a){a=a||"analytics",t.lrChartInstances[a]&&(Object.values(t.lrChartInstances[a]).forEach(function(t){t&&t.destroy&&t.destroy()}),t.lrChartInstances[a]={})},t.lrGetChart=function(a,n){n=n||(t.lrAnalyticsConfig?t.lrAnalyticsConfig.prefix:"analytics");var e=a.replace(/-/g,"_");return t.lrChartInstances[n]&&t.lrChartInstances[n][e]||null}}(window);